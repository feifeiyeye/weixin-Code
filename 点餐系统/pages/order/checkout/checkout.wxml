<!--pages/order/checkout/checkout.wxml-->
<wxs module="utils">
module.exports = {
  formatPrice: function(price) {
    return '￥' + parseFloat(price).toFixed(2)
  }
}
</wxs>

<view class="page-container">
  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <text>加载中...</text>
  </view>

  <!-- 错误提示 -->
  <view wx:elif="{{error}}" class="error-container">
    <text>{{error}}</text>
    <button class="retry-btn" bindtap="retry">重试</button>
  </view>

  <!-- 订单内容 -->
  <block wx:else>
    <view class="content">
      <!-- 标题 -->
      <view class="content-title">请确认您的订单</view>
      
      <!-- 订单信息 -->
      <view class="order">
        <!-- 商品列表 -->
        <view 
          class="order-item" 
          wx:for="{{orderInfo.foods}}" 
          wx:key="id">
          <view class="order-item-left">
            <image 
              class="order-item-image" 
              mode="aspectFill" 
              src="{{item.image_url}}"
              lazy-load />
            <view class="order-item-info">
              <view class="order-item-name">{{item.name}}</view>
              <view class="order-item-number">x {{item.number}}</view>
            </view>
          </view>
          <view class="order-item-price">
            {{utils.formatPrice(item.price * item.number)}}
          </view>
        </view>

        <!-- 满减信息 -->
        <view class="order-item" wx:if="{{hasPromotion()}}">
          <view class="order-item-left">
            <text class="promotion-tag">减</text>
            <text>满减优惠</text>
          </view>
          <view class="promotion-price">
            -{{utils.formatPrice(orderInfo.promotion)}}
          </view>
        </view>

        <!-- 小计 -->
        <view class="order-item">
          <view class="order-item-left">小计</view>
          <view class="total-price">
            {{utils.formatPrice(orderInfo.price)}}
          </view>
        </view>
      </view>

      <!-- 备注 -->
      <view class="comment-section">
        <text class="comment-label">备注</text>
        <textarea 
          class="comment-input"
          placeholder="如有其他要求，请输入备注" 
          bindinput="onCommentInput"
          value="{{comment}}"
          maxlength="100"
        ></textarea>
      </view>
    </view>

    <!-- 支付区域 -->
    <view class="operate">
      <view class="price-info">
        合计: {{utils.formatPrice(orderInfo.price)}}
      </view>
      <button 
        class="submit-btn {{submitting ? 'disabled' : ''}}"
        bindtap="submitPay"
        disabled="{{submitting}}">
        {{submitting ? '支付中...' : '去支付'}}
      </button>
    </view>
  </block>
</view>